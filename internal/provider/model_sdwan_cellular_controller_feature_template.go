// Copyright Â© 2023 Cisco Systems, Inc. and its affiliates.
// All rights reserved.
//
// Licensed under the Mozilla Public License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     https://mozilla.org/MPL/2.0/
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
//
// SPDX-License-Identifier: MPL-2.0

// Code generated by "gen/generator.go"; DO NOT EDIT.

package provider

import (
	"context"
	"strconv"

	"github.com/CiscoDevNet/terraform-provider-sdwan/internal/provider/helpers"
	"github.com/hashicorp/terraform-plugin-framework/types"
	"github.com/tidwall/gjson"
	"github.com/tidwall/sjson"
)

type CellularController struct {
	Id                            types.String                         `tfsdk:"id"`
	Version                       types.Int64                          `tfsdk:"version"`
	TemplateType                  types.String                         `tfsdk:"template_type"`
	Name                          types.String                         `tfsdk:"name"`
	Description                   types.String                         `tfsdk:"description"`
	DeviceTypes                   types.Set                            `tfsdk:"device_types"`
	CellularInterfaceName         types.String                         `tfsdk:"cellular_interface_name"`
	CellularInterfaceNameVariable types.String                         `tfsdk:"cellular_interface_name_variable"`
	DataProfileLists              []CellularControllerDataProfileLists `tfsdk:"data_profile_lists"`
	PrimarySimSlot                types.Int64                          `tfsdk:"primary_sim_slot"`
	PrimarySimSlotVariable        types.String                         `tfsdk:"primary_sim_slot_variable"`
	SimFailoverRetries            types.Int64                          `tfsdk:"sim_failover_retries"`
	SimFailoverRetriesVariable    types.String                         `tfsdk:"sim_failover_retries_variable"`
	SimFailoverTimeout            types.Int64                          `tfsdk:"sim_failover_timeout"`
	SimFailoverTimeoutVariable    types.String                         `tfsdk:"sim_failover_timeout_variable"`
	FirmAutoSim                   types.Bool                           `tfsdk:"firm_auto_sim"`
	FirmAutoSimVariable           types.String                         `tfsdk:"firm_auto_sim_variable"`
}

type CellularControllerDataProfileLists struct {
	Optional              types.Bool   `tfsdk:"optional"`
	SlotNumber            types.Int64  `tfsdk:"slot_number"`
	SlotNumberVariable    types.String `tfsdk:"slot_number_variable"`
	DataProfile           types.Int64  `tfsdk:"data_profile"`
	DataProfileVariable   types.String `tfsdk:"data_profile_variable"`
	AttachProfile         types.Int64  `tfsdk:"attach_profile"`
	AttachProfileVariable types.String `tfsdk:"attach_profile_variable"`
}

func (data CellularController) getModel() string {
	return "cellular-cedge-controller"
}

func (data CellularController) toBody(ctx context.Context) string {
	body := ""

	var device_types []string
	data.DeviceTypes.ElementsAs(ctx, &device_types, false)
	body, _ = sjson.Set(body, "deviceType", device_types)
	body, _ = sjson.Set(body, "factoryDefault", false)
	body, _ = sjson.Set(body, "templateDescription", data.Description.ValueString())
	body, _ = sjson.Set(body, "templateMinVersion", "15.0.0")
	body, _ = sjson.Set(body, "templateName", data.Name.ValueString())
	body, _ = sjson.Set(body, "templateType", "cellular-cedge-controller")
	body, _ = sjson.Set(body, "templateDefinition", map[string]interface{}{})

	path := "templateDefinition."

	if !data.CellularInterfaceNameVariable.IsNull() {
		body, _ = sjson.Set(body, path+"id."+"vipObjectType", "object")
		body, _ = sjson.Set(body, path+"id."+"vipType", "variableName")
		body, _ = sjson.Set(body, path+"id."+"vipVariableName", data.CellularInterfaceNameVariable.ValueString())
	} else if data.CellularInterfaceName.IsNull() {
	} else {
		body, _ = sjson.Set(body, path+"id."+"vipObjectType", "object")
		body, _ = sjson.Set(body, path+"id."+"vipType", "constant")
		body, _ = sjson.Set(body, path+"id."+"vipValue", data.CellularInterfaceName.ValueString())
	}
	if len(data.DataProfileLists) > 0 {
		body, _ = sjson.Set(body, path+"lte.sim.data-profile-list."+"vipObjectType", "tree")
		body, _ = sjson.Set(body, path+"lte.sim.data-profile-list."+"vipType", "constant")
		body, _ = sjson.Set(body, path+"lte.sim.data-profile-list."+"vipPrimaryKey", []string{"slot"})
		body, _ = sjson.Set(body, path+"lte.sim.data-profile-list."+"vipValue", []interface{}{})
	} else {
		body, _ = sjson.Set(body, path+"lte.sim.data-profile-list."+"vipObjectType", "tree")
		body, _ = sjson.Set(body, path+"lte.sim.data-profile-list."+"vipType", "ignore")
		body, _ = sjson.Set(body, path+"lte.sim.data-profile-list."+"vipPrimaryKey", []string{"slot"})
		body, _ = sjson.Set(body, path+"lte.sim.data-profile-list."+"vipValue", []interface{}{})
	}
	for _, item := range data.DataProfileLists {
		itemBody := ""
		itemAttributes := make([]string, 0)
		itemAttributes = append(itemAttributes, "slot")

		if !item.SlotNumberVariable.IsNull() {
			itemBody, _ = sjson.Set(itemBody, "slot."+"vipObjectType", "object")
			itemBody, _ = sjson.Set(itemBody, "slot."+"vipType", "variableName")
			itemBody, _ = sjson.Set(itemBody, "slot."+"vipVariableName", item.SlotNumberVariable.ValueString())
		} else if item.SlotNumber.IsNull() {
		} else {
			itemBody, _ = sjson.Set(itemBody, "slot."+"vipObjectType", "object")
			itemBody, _ = sjson.Set(itemBody, "slot."+"vipType", "constant")
			itemBody, _ = sjson.Set(itemBody, "slot."+"vipValue", item.SlotNumber.ValueInt64())
		}
		itemAttributes = append(itemAttributes, "data-profile")

		if !item.DataProfileVariable.IsNull() {
			itemBody, _ = sjson.Set(itemBody, "data-profile."+"vipObjectType", "object")
			itemBody, _ = sjson.Set(itemBody, "data-profile."+"vipType", "variableName")
			itemBody, _ = sjson.Set(itemBody, "data-profile."+"vipVariableName", item.DataProfileVariable.ValueString())
		} else if item.DataProfile.IsNull() {
		} else {
			itemBody, _ = sjson.Set(itemBody, "data-profile."+"vipObjectType", "object")
			itemBody, _ = sjson.Set(itemBody, "data-profile."+"vipType", "constant")
			itemBody, _ = sjson.Set(itemBody, "data-profile."+"vipValue", item.DataProfile.ValueInt64())
		}
		itemAttributes = append(itemAttributes, "attach-profile")

		if !item.AttachProfileVariable.IsNull() {
			itemBody, _ = sjson.Set(itemBody, "attach-profile."+"vipObjectType", "object")
			itemBody, _ = sjson.Set(itemBody, "attach-profile."+"vipType", "variableName")
			itemBody, _ = sjson.Set(itemBody, "attach-profile."+"vipVariableName", item.AttachProfileVariable.ValueString())
		} else if item.AttachProfile.IsNull() {
		} else {
			itemBody, _ = sjson.Set(itemBody, "attach-profile."+"vipObjectType", "object")
			itemBody, _ = sjson.Set(itemBody, "attach-profile."+"vipType", "constant")
			itemBody, _ = sjson.Set(itemBody, "attach-profile."+"vipValue", item.AttachProfile.ValueInt64())
		}
		if !item.Optional.IsNull() {
			itemBody, _ = sjson.Set(itemBody, "vipOptional", item.Optional.ValueBool())
			itemBody, _ = sjson.Set(itemBody, "priority-order", itemAttributes)
		}
		body, _ = sjson.SetRaw(body, path+"lte.sim.data-profile-list."+"vipValue.-1", itemBody)
	}

	if !data.PrimarySimSlotVariable.IsNull() {
		body, _ = sjson.Set(body, path+"lte.sim.primary.slot."+"vipObjectType", "object")
		body, _ = sjson.Set(body, path+"lte.sim.primary.slot."+"vipType", "variableName")
		body, _ = sjson.Set(body, path+"lte.sim.primary.slot."+"vipVariableName", data.PrimarySimSlotVariable.ValueString())
	} else if data.PrimarySimSlot.IsNull() {
		body, _ = sjson.Set(body, path+"lte.sim.primary.slot."+"vipObjectType", "object")
		body, _ = sjson.Set(body, path+"lte.sim.primary.slot."+"vipType", "ignore")
	} else {
		body, _ = sjson.Set(body, path+"lte.sim.primary.slot."+"vipObjectType", "object")
		body, _ = sjson.Set(body, path+"lte.sim.primary.slot."+"vipType", "constant")
		body, _ = sjson.Set(body, path+"lte.sim.primary.slot."+"vipValue", data.PrimarySimSlot.ValueInt64())
	}

	if !data.SimFailoverRetriesVariable.IsNull() {
		body, _ = sjson.Set(body, path+"lte.sim.max-retry."+"vipObjectType", "object")
		body, _ = sjson.Set(body, path+"lte.sim.max-retry."+"vipType", "variableName")
		body, _ = sjson.Set(body, path+"lte.sim.max-retry."+"vipVariableName", data.SimFailoverRetriesVariable.ValueString())
	} else if data.SimFailoverRetries.IsNull() {
		body, _ = sjson.Set(body, path+"lte.sim.max-retry."+"vipObjectType", "object")
		body, _ = sjson.Set(body, path+"lte.sim.max-retry."+"vipType", "ignore")
	} else {
		body, _ = sjson.Set(body, path+"lte.sim.max-retry."+"vipObjectType", "object")
		body, _ = sjson.Set(body, path+"lte.sim.max-retry."+"vipType", "constant")
		body, _ = sjson.Set(body, path+"lte.sim.max-retry."+"vipValue", data.SimFailoverRetries.ValueInt64())
	}

	if !data.SimFailoverTimeoutVariable.IsNull() {
		body, _ = sjson.Set(body, path+"lte.failovertimer."+"vipObjectType", "object")
		body, _ = sjson.Set(body, path+"lte.failovertimer."+"vipType", "variableName")
		body, _ = sjson.Set(body, path+"lte.failovertimer."+"vipVariableName", data.SimFailoverTimeoutVariable.ValueString())
	} else if data.SimFailoverTimeout.IsNull() {
		body, _ = sjson.Set(body, path+"lte.failovertimer."+"vipObjectType", "object")
		body, _ = sjson.Set(body, path+"lte.failovertimer."+"vipType", "ignore")
	} else {
		body, _ = sjson.Set(body, path+"lte.failovertimer."+"vipObjectType", "object")
		body, _ = sjson.Set(body, path+"lte.failovertimer."+"vipType", "constant")
		body, _ = sjson.Set(body, path+"lte.failovertimer."+"vipValue", data.SimFailoverTimeout.ValueInt64())
	}

	if !data.FirmAutoSimVariable.IsNull() {
		body, _ = sjson.Set(body, path+"lte.firmware.auto-sim."+"vipObjectType", "node-only")
		body, _ = sjson.Set(body, path+"lte.firmware.auto-sim."+"vipType", "variableName")
		body, _ = sjson.Set(body, path+"lte.firmware.auto-sim."+"vipVariableName", data.FirmAutoSimVariable.ValueString())
	} else if data.FirmAutoSim.IsNull() {
		body, _ = sjson.Set(body, path+"lte.firmware.auto-sim."+"vipObjectType", "node-only")
		body, _ = sjson.Set(body, path+"lte.firmware.auto-sim."+"vipType", "ignore")
	} else {
		body, _ = sjson.Set(body, path+"lte.firmware.auto-sim."+"vipObjectType", "node-only")
		body, _ = sjson.Set(body, path+"lte.firmware.auto-sim."+"vipType", "constant")
		body, _ = sjson.Set(body, path+"lte.firmware.auto-sim."+"vipValue", strconv.FormatBool(data.FirmAutoSim.ValueBool()))
	}
	return body
}

func (data *CellularController) fromBody(ctx context.Context, res gjson.Result) {
	if value := res.Get("deviceType"); value.Exists() {
		data.DeviceTypes = helpers.GetStringSet(value.Array())
	} else {
		data.DeviceTypes = types.SetNull(types.StringType)
	}
	if value := res.Get("templateDescription"); value.Exists() && value.String() != "" {
		data.Description = types.StringValue(value.String())
	} else {
		data.Description = types.StringNull()
	}
	if value := res.Get("templateName"); value.Exists() {
		data.Name = types.StringValue(value.String())
	} else {
		data.Name = types.StringNull()
	}
	if value := res.Get("templateType"); value.Exists() {
		data.TemplateType = types.StringValue(value.String())
	} else {
		data.TemplateType = types.StringNull()
	}

	path := "templateDefinition."
	if value := res.Get(path + "id.vipType"); value.Exists() {
		if value.String() == "variableName" {
			data.CellularInterfaceName = types.StringNull()

			v := res.Get(path + "id.vipVariableName")
			data.CellularInterfaceNameVariable = types.StringValue(v.String())

		} else if value.String() == "ignore" {
			data.CellularInterfaceName = types.StringNull()
			data.CellularInterfaceNameVariable = types.StringNull()
		} else if value.String() == "constant" {
			v := res.Get(path + "id.vipValue")
			data.CellularInterfaceName = types.StringValue(v.String())
			data.CellularInterfaceNameVariable = types.StringNull()
		}
	} else {
		data.CellularInterfaceName = types.StringNull()
		data.CellularInterfaceNameVariable = types.StringNull()
	}
	if value := res.Get(path + "lte.sim.data-profile-list.vipValue"); len(value.Array()) > 0 {
		data.DataProfileLists = make([]CellularControllerDataProfileLists, 0)
		value.ForEach(func(k, v gjson.Result) bool {
			item := CellularControllerDataProfileLists{}
			if cValue := v.Get("vipOptional"); cValue.Exists() {
				item.Optional = types.BoolValue(cValue.Bool())
			} else {
				item.Optional = types.BoolNull()
			}
			if cValue := v.Get("slot.vipType"); cValue.Exists() {
				if cValue.String() == "variableName" {
					item.SlotNumber = types.Int64Null()

					cv := v.Get("slot.vipVariableName")
					item.SlotNumberVariable = types.StringValue(cv.String())

				} else if cValue.String() == "ignore" {
					item.SlotNumber = types.Int64Null()
					item.SlotNumberVariable = types.StringNull()
				} else if cValue.String() == "constant" {
					cv := v.Get("slot.vipValue")
					item.SlotNumber = types.Int64Value(cv.Int())
					item.SlotNumberVariable = types.StringNull()
				}
			} else {
				item.SlotNumber = types.Int64Null()
				item.SlotNumberVariable = types.StringNull()
			}
			if cValue := v.Get("data-profile.vipType"); cValue.Exists() {
				if cValue.String() == "variableName" {
					item.DataProfile = types.Int64Null()

					cv := v.Get("data-profile.vipVariableName")
					item.DataProfileVariable = types.StringValue(cv.String())

				} else if cValue.String() == "ignore" {
					item.DataProfile = types.Int64Null()
					item.DataProfileVariable = types.StringNull()
				} else if cValue.String() == "constant" {
					cv := v.Get("data-profile.vipValue")
					item.DataProfile = types.Int64Value(cv.Int())
					item.DataProfileVariable = types.StringNull()
				}
			} else {
				item.DataProfile = types.Int64Null()
				item.DataProfileVariable = types.StringNull()
			}
			if cValue := v.Get("attach-profile.vipType"); cValue.Exists() {
				if cValue.String() == "variableName" {
					item.AttachProfile = types.Int64Null()

					cv := v.Get("attach-profile.vipVariableName")
					item.AttachProfileVariable = types.StringValue(cv.String())

				} else if cValue.String() == "ignore" {
					item.AttachProfile = types.Int64Null()
					item.AttachProfileVariable = types.StringNull()
				} else if cValue.String() == "constant" {
					cv := v.Get("attach-profile.vipValue")
					item.AttachProfile = types.Int64Value(cv.Int())
					item.AttachProfileVariable = types.StringNull()
				}
			} else {
				item.AttachProfile = types.Int64Null()
				item.AttachProfileVariable = types.StringNull()
			}
			data.DataProfileLists = append(data.DataProfileLists, item)
			return true
		})
	}
	if value := res.Get(path + "lte.sim.primary.slot.vipType"); value.Exists() {
		if value.String() == "variableName" {
			data.PrimarySimSlot = types.Int64Null()

			v := res.Get(path + "lte.sim.primary.slot.vipVariableName")
			data.PrimarySimSlotVariable = types.StringValue(v.String())

		} else if value.String() == "ignore" {
			data.PrimarySimSlot = types.Int64Null()
			data.PrimarySimSlotVariable = types.StringNull()
		} else if value.String() == "constant" {
			v := res.Get(path + "lte.sim.primary.slot.vipValue")
			data.PrimarySimSlot = types.Int64Value(v.Int())
			data.PrimarySimSlotVariable = types.StringNull()
		}
	} else {
		data.PrimarySimSlot = types.Int64Null()
		data.PrimarySimSlotVariable = types.StringNull()
	}
	if value := res.Get(path + "lte.sim.max-retry.vipType"); value.Exists() {
		if value.String() == "variableName" {
			data.SimFailoverRetries = types.Int64Null()

			v := res.Get(path + "lte.sim.max-retry.vipVariableName")
			data.SimFailoverRetriesVariable = types.StringValue(v.String())

		} else if value.String() == "ignore" {
			data.SimFailoverRetries = types.Int64Null()
			data.SimFailoverRetriesVariable = types.StringNull()
		} else if value.String() == "constant" {
			v := res.Get(path + "lte.sim.max-retry.vipValue")
			data.SimFailoverRetries = types.Int64Value(v.Int())
			data.SimFailoverRetriesVariable = types.StringNull()
		}
	} else {
		data.SimFailoverRetries = types.Int64Null()
		data.SimFailoverRetriesVariable = types.StringNull()
	}
	if value := res.Get(path + "lte.failovertimer.vipType"); value.Exists() {
		if value.String() == "variableName" {
			data.SimFailoverTimeout = types.Int64Null()

			v := res.Get(path + "lte.failovertimer.vipVariableName")
			data.SimFailoverTimeoutVariable = types.StringValue(v.String())

		} else if value.String() == "ignore" {
			data.SimFailoverTimeout = types.Int64Null()
			data.SimFailoverTimeoutVariable = types.StringNull()
		} else if value.String() == "constant" {
			v := res.Get(path + "lte.failovertimer.vipValue")
			data.SimFailoverTimeout = types.Int64Value(v.Int())
			data.SimFailoverTimeoutVariable = types.StringNull()
		}
	} else {
		data.SimFailoverTimeout = types.Int64Null()
		data.SimFailoverTimeoutVariable = types.StringNull()
	}
	if value := res.Get(path + "lte.firmware.auto-sim.vipType"); value.Exists() {
		if value.String() == "variableName" {
			data.FirmAutoSim = types.BoolNull()

			v := res.Get(path + "lte.firmware.auto-sim.vipVariableName")
			data.FirmAutoSimVariable = types.StringValue(v.String())

		} else if value.String() == "ignore" {
			data.FirmAutoSim = types.BoolNull()
			data.FirmAutoSimVariable = types.StringNull()
		} else if value.String() == "constant" {
			v := res.Get(path + "lte.firmware.auto-sim.vipValue")
			data.FirmAutoSim = types.BoolValue(v.Bool())
			data.FirmAutoSimVariable = types.StringNull()
		}
	} else {
		data.FirmAutoSim = types.BoolNull()
		data.FirmAutoSimVariable = types.StringNull()
	}
}

func (data *CellularController) hasChanges(ctx context.Context, state *CellularController) bool {
	hasChanges := false
	if !data.CellularInterfaceName.Equal(state.CellularInterfaceName) {
		hasChanges = true
	}
	if len(data.DataProfileLists) != len(state.DataProfileLists) {
		hasChanges = true
	} else {
		for i := range data.DataProfileLists {
			if !data.DataProfileLists[i].SlotNumber.Equal(state.DataProfileLists[i].SlotNumber) {
				hasChanges = true
			}
			if !data.DataProfileLists[i].DataProfile.Equal(state.DataProfileLists[i].DataProfile) {
				hasChanges = true
			}
			if !data.DataProfileLists[i].AttachProfile.Equal(state.DataProfileLists[i].AttachProfile) {
				hasChanges = true
			}
		}
	}
	if !data.PrimarySimSlot.Equal(state.PrimarySimSlot) {
		hasChanges = true
	}
	if !data.SimFailoverRetries.Equal(state.SimFailoverRetries) {
		hasChanges = true
	}
	if !data.SimFailoverTimeout.Equal(state.SimFailoverTimeout) {
		hasChanges = true
	}
	if !data.FirmAutoSim.Equal(state.FirmAutoSim) {
		hasChanges = true
	}
	return hasChanges
}
